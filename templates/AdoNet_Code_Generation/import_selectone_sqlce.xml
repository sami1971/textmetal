<?xml version="1.0" encoding="utf-8"?>

<!--
	Copyright ©2002-2011 Daniel Bullington (dpbullington@gmail.com)
	Distributed under the MIT license: http://www.opensource.org/licenses/mit-license.php
-->
<Template xmlns="http://code.google.com/p/textmetal/rev3">
		
	<!--<DebuggerBreakpoint />-->
	
	<Write newline="false">
		<Write.Text>
			<Value data="SELECT " />
		</Write.Text>
	</Write>

	<ForEach in="Columns" var-ct="#LoopCount" var-ix="#LoopIndex">
		<ForEach.Body>
			<Write newline="false">
				<Write.Text>
					<Value data="t.[${ColumnName}]" />
				</Write.Text>
			</Write>
			<If>
				<If.Condition>
					<BinaryExpression operator="Ne">
						<BinaryExpression.LeftExpression>
							<Facet name="#LoopCount" />
						</BinaryExpression.LeftExpression>
						<BinaryExpression.RightExpression>
							<Facet name="#LoopIndex" />
						</BinaryExpression.RightExpression>
					</BinaryExpression>
				</If.Condition>
				<If.True>
					<Write newline="false">
						<Write.Text>
							<Value data=", " />
						</Write.Text>
					</Write>
				</If.True>
			</If>
		</ForEach.Body>
	</ForEach>

	<Write newline="false">
		<Write.Text>
			<Value data=" FROM [${TableName}] t" />
		</Write.Text>
	</Write>
	
	<If>
		<If.Condition>
			<UnaryExpression operator="Not">
				<UnaryExpression.TheExpression>
					<Facet name="IsView" />
				</UnaryExpression.TheExpression>
			</UnaryExpression>
		</If.Condition>
		<If.True>
		
			<Write newline="false">
				<Write.Text>
					<Value data=" WHERE " />
				</Write.Text>
			</Write>

			<ForEach in="Columns" var-ct="#LoopCount" var-ix="#LoopIndex">
				<ForEach.Filter>
					<BinaryExpression operator="Or">
						<BinaryExpression.LeftExpression>
							<BinaryExpression operator="Eq">
								<BinaryExpression.LeftExpression>
									<Facet name="ColumnIsIdentity" />
								</BinaryExpression.LeftExpression>
								<BinaryExpression.RightExpression>
									<Value type="System.Boolean" data="True" />
								</BinaryExpression.RightExpression>
							</BinaryExpression>
						</BinaryExpression.LeftExpression>
						<BinaryExpression.RightExpression>
							<BinaryExpression operator="Eq">
								<BinaryExpression.LeftExpression>
									<Facet name="ColumnIsPrimaryKey" />
								</BinaryExpression.LeftExpression>
								<BinaryExpression.RightExpression>
									<Value type="System.Boolean" data="True" />
								</BinaryExpression.RightExpression>
							</BinaryExpression>
						</BinaryExpression.RightExpression>
					</BinaryExpression>
				</ForEach.Filter>
				<ForEach.Body>
					<Write newline="false">
						<Write.Text>
							<Value data="t.[${ColumnName}] = @${ColumnName}" />
						</Write.Text>
					</Write>
					<If>
						<If.Condition>
							<BinaryExpression operator="Ne">
								<BinaryExpression.LeftExpression>
									<Facet name="#LoopCount" />
								</BinaryExpression.LeftExpression>
								<BinaryExpression.RightExpression>
									<Facet name="#LoopIndex" />
								</BinaryExpression.RightExpression>
							</BinaryExpression>
						</If.Condition>
						<If.True>
							<Write newline="false">
								<Write.Text>
									<Value data=" AND " />
								</Write.Text>
							</Write>
						</If.True>
					</If>
				</ForEach.Body>
			</ForEach>
			
			<Write newline="false">
				<Write.Text>
					<Value data=" ORDER BY " />
				</Write.Text>
			</Write>

			<ForEach in="Columns" var-ct="#LoopCount" var-ix="#LoopIndex">
				<ForEach.Filter>
					<BinaryExpression operator="Or">
						<BinaryExpression.LeftExpression>
							<BinaryExpression operator="Eq">
								<BinaryExpression.LeftExpression>
									<Facet name="ColumnIsIdentity" />
								</BinaryExpression.LeftExpression>
								<BinaryExpression.RightExpression>
									<Value type="System.Boolean" data="True" />
								</BinaryExpression.RightExpression>
							</BinaryExpression>
						</BinaryExpression.LeftExpression>
						<BinaryExpression.RightExpression>
							<BinaryExpression operator="Eq">
								<BinaryExpression.LeftExpression>
									<Facet name="ColumnIsPrimaryKey" />
								</BinaryExpression.LeftExpression>
								<BinaryExpression.RightExpression>
									<Value type="System.Boolean" data="True" />
								</BinaryExpression.RightExpression>
							</BinaryExpression>
						</BinaryExpression.RightExpression>
					</BinaryExpression>
				</ForEach.Filter>
				<ForEach.Body>
					<Write newline="false">
						<Write.Text>
							<Value data="t.[${ColumnName}] ASC" />
						</Write.Text>
					</Write>
					<If>
						<If.Condition>
							<BinaryExpression operator="Ne">
								<BinaryExpression.LeftExpression>
									<Facet name="#LoopCount" />
								</BinaryExpression.LeftExpression>
								<BinaryExpression.RightExpression>
									<Facet name="#LoopIndex" />
								</BinaryExpression.RightExpression>
							</BinaryExpression>
						</If.Condition>
						<If.True>
							<Write newline="false">
								<Write.Text>
									<Value data=", " />
								</Write.Text>
							</Write>
						</If.True>
					</If>
				</ForEach.Body>
			</ForEach>			
	
		</If.True>
	</If>

</Template>